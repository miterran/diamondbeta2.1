{"version":3,"sources":["../../src/userRoutes/fetchHistoryBets.js"],"names":["HistoryBet","router","Router","get","req","res","find","user","username","completedAt","$gte","startOf","subtract","format","$lte","endOf","err","result","status","send","json","post","weekNum","body","datesData","add","weeklyHistoryResult","isEmpty","map","event","eventIdx","orderResultAmount","Total"],"mappings":"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","file":"fetchHistoryBets.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport BetOrder from '../models/BetOrder'\nconst HistoryBet = BetOrder.HistoryBet\nimport express from 'express';\nconst router = express.Router();\n\nrouter.get('/fetch-history-bets', (req, res) => {\n\tHistoryBet.find({user: req.user.username, completedAt: {$gte: moment().startOf('week').subtract(7, 'day').format(), $lte: moment().endOf('week').format()}}, function(err, result){\n\t\tif(err) res.status(404).send('fetch user history bet error')\n\t\tres.json(result)\n\t})\n})\n\nrouter.post('/fetch-history-summary', (req, res) => {\n\tconst weekNum = req.body.weekNum\n\tlet datesData = {\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(1, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(2, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(3, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(4, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(5, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(6, 'day').format('MMM DD')]: 0,\n\t\tTotal: 0\n\t}\n\tHistoryBet.find({user: req.user.username, completedAt: {$gte: moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').format(), $lte: moment().endOf('week').subtract(weekNum, 'day').add(0, 'day').format()}}, function(err, weeklyHistoryResult){\n\t\tif(err) throw err\n\t\tif(!_.isEmpty(weeklyHistoryResult)){\n\t\t\tweeklyHistoryResult.map(function(event, eventIdx){\n\t\t\t\tdatesData[moment(event.completedAt).format('MMM DD')] += event.orderResultAmount\n\t\t\t\tdatesData.Total += event.orderResultAmount\n\t\t\t})\n\t\t\tres.json(datesData)\n\t\t}else{\n\t\t\tres.json(datesData)\n\t\t}\n\t})\n\n})\n\nexport default router;\n\n"]}