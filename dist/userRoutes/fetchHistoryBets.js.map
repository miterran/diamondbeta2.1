{"version":3,"sources":["../../src/userRoutes/fetchHistoryBets.js"],"names":["HistoryBet","router","Router","get","req","res","find","user","username","completedAt","$gte","startOf","subtract","utc","format","$lte","endOf","err","result","status","send","json","post","weekNum","body","datesData","add","weeklyHistoryResult","isEmpty","map","event","eventIdx","orderResultAmount","Total"],"mappings":"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","file":"fetchHistoryBets.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport BetOrder from '../models/BetOrder'\nconst HistoryBet = BetOrder.HistoryBet\nimport express from 'express';\nconst router = express.Router();\n\nrouter.get('/fetch-history-bets', (req, res) => {\n\tHistoryBet.find({user: req.user.username, completedAt: {$gte: moment().startOf('week').subtract(7, 'day').utc('+07:00').format(), $lte: moment().endOf('week').utc('+07:00').format()}}, function(err, result){\n\t\tif(err) res.status(404).send('fetch user history bet error')\n\t\tres.json(result)\n\t})\n})\n\nrouter.post('/fetch-history-summary', (req, res) => {\n\n\n\tconst weekNum = req.body.weekNum\n\tlet datesData = {\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(1, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(2, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(3, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(4, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(5, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(6, 'day').utc('+07:00').format('MMM DD')]: 0,\n\t\tTotal: 0\n\t}\n\n\n\tHistoryBet.find({user: req.user.username, completedAt: {$gte: moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').utc('+07:00').format(), $lte: moment().endOf('week').subtract(weekNum, 'day').add(0, 'day').utc('+07:00').format()}}, function(err, weeklyHistoryResult){\n\t\tif(err) throw err\n\t\tif(!_.isEmpty(weeklyHistoryResult)){\n\t\t\tweeklyHistoryResult.map(function(event, eventIdx){\n\t\t\t\tdatesData[moment(event.completedAt).format('MMM DD')] += event.orderResultAmount\n\t\t\t\tdatesData.Total += event.orderResultAmount\n\t\t\t})\n\t\t\tres.json(datesData)\n\t\t}else{\n\t\t\tres.json(datesData)\n\t\t}\n\t})\n\n})\n\nexport default router;\n\n"]}