{"version":3,"sources":["../../src/routes/confirmEventsResult.js"],"names":["OpenBet","ReviewBet","HistoryBet","router","Router","Promise","global","defaults","headers","common","apiKey","openBetPendingMiddleWare","req","res","next","find","openBets","isEmpty","all","map","openBet","events","event","eventIdx","eventStatus","get","ID","BetDetail","OddType","response","result","Object","assign","data","Final","FinalType","BetType","OddTarget","BinaryScore","Number","HomeScore","AwayScore","Sport","OddPoint","findOneAndUpdate","orderNumber","$elemMatch","OddPickID","console","log","then","catch","err","status","send","openBetResultMiddleWare","eventsHaveWon","Status","eventsHaveLost","eventsHavePush","eventsHaveCanceled","eventsHavePostponed","eventsHaveReview","allEventsWon","every","allEventsLost","allEventsPush","allEventsCanceled","allEventsPostponed","allEventsReview","allEventsFinished","Result","resultBet","betOption","superAgent","agent","user","eventsWagerDetail","orderStatus","createdAt","completedAt","orderResultAmount","WinAmount","RiskAmount","toFixed","parlayPoint","OddLine","push","Math","abs","riskPoint","reduce","a","b","newHistoryBet","save","findOneAndRemove","_id","newReviewBet","error","json"],"mappings":"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","file":"confirmEventsResult.js","sourcesContent":["import moment from 'moment';\nimport config from '../config';\nimport BetOrder from '../models/BetOrder'\nconst OpenBet = BetOrder.OpenBet\nconst ReviewBet = BetOrder.ReviewBet\nconst HistoryBet = BetOrder.HistoryBet\nimport express from 'express';\nconst router = express.Router();\nimport mongoose from 'mongoose';\nmongoose.Promise = global.Promise;\n\nimport _ from 'lodash';\nimport axios from 'axios';\naxios.defaults.headers.common['JsonOdds-API-Key'] = config.apiKey;\n\n\nconst openBetPendingMiddleWare = async function(req, res, next){\n\tconst openBets = await OpenBet.find({});\n\tif(!_.isEmpty(openBets)){\n\t\tawait Promise.all(openBets.map(async openBet => {\n\t\t\tawait Promise.all(openBet.events.map(async (event, eventIdx) => {\n\t\t\t\tlet eventStatus = 'Pending';\n\t\t\t\tconst response = await axios.get(`https://jsonodds.com/api/results/getbyeventid/${event.ID}?oddType=${event.BetDetail.OddType}`);\n\t\t\t\tconst result = Object.assign({}, response.data[0]);\n\t\t\t\tif(!_.isEmpty(result)){\n\t\t\t\t\tif(result.Final){\n\t\t\t\t\t\tswitch(result.FinalType){\n\t\t\t\t\t\t\tcase 'Finished':\n\t\t\t\t\t\t\t\tswitch(event.BetDetail.BetType){\n\t\t\t\t\t\t\t\t\tcase 'M-Line':\n\t\t\t\t\t\t\t\t\t\tswitch(true){\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && result.BinaryScore === '1-0':\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) > Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && result.BinaryScore === '0-1':\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && Number(result.HomeScore) < Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Won';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && result.BinaryScore === '0-1':\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) < Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && result.BinaryScore === '1-0':\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && Number(result.HomeScore) > Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Lost';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase result.BinaryScore === '0-0':\n\t\t\t\t\t\t\t\t\t\t\tcase Number(result.HomeScore) === Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\t\tif(event.Sport === 7){\n\t\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Lost' \n\t\t\t\t\t\t\t\t\t\t\t\t}else{ \n\t\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Push' \n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Review';\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Spread':\n\t\t\t\t\t\t\t\t\t\tswitch(true){\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) + Number(event.BetDetail.OddPoint) - Number(result.AwayScore) === 0.25:\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Away' && Number(result.AwayScore) + Number(event.BetDetail.OddPoint) - Number(result.HomeScore) === 0.25:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'WonHalf';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) + Number(event.BetDetail.OddPoint) - Number(result.AwayScore) === -0.25:\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Away' && Number(result.AwayScore) + Number(event.BetDetail.OddPoint) - Number(result.HomeScore) === -0.25:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'LostHalf';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) + Number(event.BetDetail.OddPoint) > Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && Number(result.AwayScore) + Number(event.BetDetail.OddPoint) > Number(result.HomeScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Won';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) + Number(event.BetDetail.OddPoint) < Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && Number(result.AwayScore) + Number(event.BetDetail.OddPoint) < Number(result.HomeScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Lost';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Home' && Number(result.HomeScore) + Number(event.BetDetail.OddPoint) === Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Away' && Number(result.AwayScore) + Number(event.BetDetail.OddPoint) === Number(result.HomeScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Push';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Review';\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Total':\n\t\t\t\t\t\t\t\t\t\tswitch(true){\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Over' && Number(result.HomeScore) + Number(result.AwayScore) - Number(event.BetDetail.OddPoint) === 0.25:\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Under' && Number(event.BetDetail.OddPoint) - (Number(result.HomeScore) + Number(result.AwayScore)) === 0.25:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'WonHalf';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Over' && Number(result.HomeScore) + Number(result.AwayScore) - Number(event.BetDetail.OddPoint) === -0.25:\n\t\t\t\t\t\t\t\t\t\t\tcase event.Sport === 7 && event.BetDetail.OddTarget === 'Under' && Number(event.BetDetail.OddPoint) - (Number(result.HomeScore) + Number(result.AwayScore)) === -0.25:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'LostHalf';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Over' && Number(result.HomeScore) + Number(result.AwayScore) > Number(event.BetDetail.OddPoint):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Under' && Number(result.HomeScore) + Number(result.AwayScore) < Number(event.BetDetail.OddPoint):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Won';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Over' && Number(result.HomeScore) + Number(result.AwayScore) < Number(event.BetDetail.OddPoint):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Under' && Number(result.HomeScore) + Number(result.AwayScore) > Number(event.BetDetail.OddPoint):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Lost';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Over' && Number(result.HomeScore) + Number(result.AwayScore) === Number(event.BetDetail.OddPoint):\n\t\t\t\t\t\t\t\t\t\t\tcase event.BetDetail.OddTarget === 'Under' && Number(result.HomeScore) + Number(result.AwayScore) === Number(event.BetDetail.OddPoint):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Push';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Review';\n\t\t\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Draw':\n\t\t\t\t\t\t\t\t\t\tswitch(true){\n\t\t\t\t\t\t\t\t\t\t\tcase result.BinaryScore === '0-0':\n\t\t\t\t\t\t\t\t\t\t\tcase Number(result.HomeScore) === Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Won';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase result.BinaryScore === '1-0':\n\t\t\t\t\t\t\t\t\t\t\tcase result.BinaryScore === '0-1':\n\t\t\t\t\t\t\t\t\t\t\tcase Number(result.HomeScore) !== Number(result.AwayScore):\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Lost';\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\t\teventStatus = 'Review';\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\teventStatus = 'Review';\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'Canceled':\n\t\t\t\t\t\t\t\teventStatus = 'Canceled'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'Postponed':\n\t\t\t\t\t\t\t\teventStatus = 'Postponed'\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\teventStatus = 'Review'\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\teventStatus = 'Pending';\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\teventStatus = 'Review';\n\t\t\t\t}\n\t\t\t\tawait OpenBet.findOneAndUpdate({orderNumber: openBet.orderNumber, events: {$elemMatch: {'ID': event.ID, 'OddPickID': event.OddPickID, 'BetDetail.OddType': event.BetDetail.OddType}} } , { '$set': { 'events.$.Status': eventStatus, 'events.$.Result': result }})\n\t\t\t\tconsole.log('updated event result')\n\t\t\t})).then(() => {\n\t\t\t\tconsole.log('this bet result done'\n\t\t\t)}).catch((err) => {\n\t\t\t\tconsole.log('bet result update error')\n\t\t\t\tres.status(404).send('event update error')\n\t\t\t})\n\t\t})).then(() => {\n\t\t\tconsole.log('all open bets updated')\n\t\t\tnext()\n\t\t}).catch((err) => {\n\t\t\tconsole.log('all open bets updated error')\n\t\t\tres.status(404).send('all open bets updated error')\n\t\t})\n\t}else{\n\t\tconsole.log('openBet is empty')\n\t\tres.status(202).send('openBet is empty')\n\t}\n\t\n}\n\nconst openBetResultMiddleWare = async function(req, res, next){\n\tconst openBets = await OpenBet.find({});\n\tif(!_.isEmpty(openBets)){\n\t\tawait Promise.all(openBets.map(async function(openBet){\n\n\t\t\tconst eventsHaveWon = _.find(openBet.events, (event) => event.Status === 'Won')\n\t\t\tconst eventsHaveLost = _.find(openBet.events, (event) => event.Status === 'Lost')\n\t\t\tconst eventsHavePush = _.find(openBet.events, (event) => event.Status === 'Push')\n\t\t\tconst eventsHaveCanceled = _.find(openBet.events, (event) => event.Status === 'Canceled')\n\t\t\tconst eventsHavePostponed = _.find(openBet.events, (event) => event.Status === 'Postponed')\n\t\t\tconst eventsHaveReview = _.find(openBet.events, (event) => event.Status === 'Review')\n\n\t\t\tconst allEventsWon = openBet.events.every((event) => event.Status === 'Won' )\n\t\t\tconst allEventsLost = openBet.events.every((event) => event.Status === 'Lost' )\n\t\t\tconst allEventsPush = openBet.events.every((event) => event.Status === 'Push' )\n\t\t\tconst allEventsCanceled = openBet.events.every((event) => event.Status === 'Canceled' )\n\t\t\tconst allEventsPostponed = openBet.events.every((event) => event.Status === 'Postponed' )\n\t\t\tconst allEventsReview = openBet.events.every((event) => event.Status === 'Review' )\n\n\t\t\tconst allEventsFinished = openBet.events.every((event) => event.Result.Final === true )\n\t\t\tif(allEventsFinished){\n\n\t\t\t\tlet resultBet = {\n\t\t    \t\torderNumber: openBet.orderNumber,\n\t\t    \t\tbetOption: openBet.betOption,\n\t\t    \t\tsuperAgent: openBet.superAgent,\n\t\t    \t\tagent: openBet.agent,\n\t\t    \t\tuser: openBet.user,\n\t\t    \t\tevents: openBet.events,\n\t\t    \t\teventsWagerDetail: openBet.eventsWagerDetail,\n\t\t    \t\torderStatus: 'Pending',\n\t\t    \t\tcreatedAt: openBet.createdAt,\n\t\t    \t\tcompletedAt: moment(),\n\t\t    \t\torderResultAmount: 0\n\t\t\t\t}\n\n\t\t\t\tif(openBet.betOption === 'Straight'){\n\t\t\t\t\tswitch(openBet.events[0].Status){\n\t\t\t\t\t\tcase 'Won':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Won';\n\t\t\t\t\t\t\tresultBet.orderResultAmount = openBet.eventsWagerDetail.WinAmount;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Lost':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Lost';\n\t\t\t\t\t\t\tresultBet.orderResultAmount = -Number(openBet.eventsWagerDetail.RiskAmount);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'WonHalf':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'WonHalf';\n\t\t\t\t\t\t\tresultBet.orderResultAmount = (Number(openBet.eventsWagerDetail.WinAmount) / 2).toFixed();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'LostHalf':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'LostHalf';\n\t\t\t\t\t\t\tresultBet.orderResultAmount = -(Number(openBet.eventsWagerDetail.RiskAmount) / 2).toFixed();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Push':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Push';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Postponed':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Postponed';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Canceled':\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Canceled';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Review';\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(openBet.betOption === 'Parlay'){\n\t\t\t\t\tswitch(true){\n\t\t\t\t\t\tcase allEventsPush:\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Push'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase allEventsCanceled:\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Canceled'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase !_.isEmpty(eventsHaveWon) &&  _.isEmpty(eventsHaveReview) && _.isEmpty(eventsHaveLost) && _.isEmpty(eventsHavePostponed) || allEventsWon:\n\t\t\t\t\t\t\tlet parlayPoint = []\n\t\t\t\t\t\t\topenBet.events.map(event => {\n\t\t\t\t\t\t\t\tif(event.Status === 'Won'){\n\t\t\t\t\t\t\t\t\tif(event.BetDetail.OddLine > 0){ \n\t\t\t\t\t\t\t\t\t\tparlayPoint.push((Number(event.BetDetail.OddLine) + 100) / 100)\n\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\tparlayPoint.push((Math.abs(event.BetDetail.OddLine) + 100) / Math.abs(event.BetDetail.OddLine))\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tlet riskPoint = parlayPoint.reduce((a, b) =>  a * b )\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Won';\n\t\t\t\t\t\t\tresultBet.orderResultAmount = ((Number(openBet.eventsWagerDetail.RiskAmount) * Number(riskPoint) - Number(openBet.eventsWagerDetail.RiskAmount)) * 1).toFixed()\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase !_.isEmpty(eventsHaveLost):\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Lost'\n\t\t\t\t\t\t\tresultBet.orderResultAmount = -Number(openBet.eventsWagerDetail.RiskAmount);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase !_.isEmpty(eventsHavePostponed):\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Postponed'\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tresultBet.orderStatus = 'Review'\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(resultBet.orderStatus !== 'Pending'){\n\t\t\t\t\tif(resultBet.orderStatus !== 'Review' || resultBet.orderStatus !== 'Postponed'){\n\t\t\t\t\t\tlet newHistoryBet = new HistoryBet(resultBet)\n\t\t\t\t\t\tawait newHistoryBet.save()\n\t\t\t\t\t\tawait OpenBet.findOneAndRemove({ _id: openBet._id})\n\t\t\t\t\t}else{\n\t\t\t\t\t\tlet newReviewBet = new ReviewBet(resultBet)\n\t\t\t\t\t\tawait newReviewBet.save()\n\t\t\t\t\t\tawait OpenBet.findOneAndRemove({ _id: openBet._id})\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('open bet result calculate has error')\n\t\t\t\t}\n\t\t\t}\n\n\t\t})).then(() => {\n\t\t\tconsole.log('open bet result done')\n\t\t\tnext()\n\t\t}).catch((error) => {\n\t\t\tconsole.log('open bet result error')\n\t\t\tres.status(404).send('open bet result error')\n\t\t})\n\t}else{\n\t\tconsole.log('openBet is empty')\n\t\tnext()\n\t}\n}\n\n\nrouter.get('/confirm-events-result', openBetPendingMiddleWare, openBetResultMiddleWare, (req, res) => {\n\tres.send('confirm open bet result done');\n})\n\nrouter.get('/result', async (req, res) => {\n\tconst response = await axios.get(`https://jsonodds.com/api/results`);\n\tres.json(response.data)\n\n})\n\nexport default router;"]}