{"version":3,"sources":["../../src/agentRoutes/fetchAgentState.js"],"names":["HistoryBet","OpenBet","router","Router","get","req","res","agentCreditPending","openBetTotalRiskAmount","openBetTotalWinAmount","openBetStraight","openBetParlay","totalGamePending","find","agent","user","username","openBets","isEmpty","map","openBet","betOption","Number","eventsWagerDetail","RiskAmount","WinAmount","findOneAndUpdate","$set","creditPending","new","err","result","pick","json","post","weekNum","body","datesData","startOf","subtract","add","format","completedAt","$gte","$lte","endOf","weeklyHistoryResult","event","eventIdx","orderResultAmount","Total"],"mappings":"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","file":"fetchAgentState.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport BetOrder from '../models/BetOrder'\nconst HistoryBet = BetOrder.HistoryBet\nconst OpenBet = BetOrder.OpenBet\nimport Agent from '../models/Agent';\nimport express from 'express';\nconst router = express.Router();\n\nrouter.get('/fetch-agent-state', async (req, res) => {\n\n\tlet agentCreditPending = 0\n\n\tlet openBetTotalRiskAmount = 0\n\tlet openBetTotalWinAmount = 0\n\n    let openBetStraight = 0\n    let openBetParlay = 0\n    let totalGamePending = 0\n\n\n\tconst openBets = await OpenBet.find({ agent: req.user.username })\n\tif(!_.isEmpty(openBets)){\n\t\topenBets.map(function(openBet){\n\t\t\tif(openBet.betOption === 'Straight'){\n\t\t\t\topenBetStraight++\n\t\t\t}\n\t\t\tif(openBet.betOption === 'Parlay'){\n\t\t\t\topenBetParlay++\n\t\t\t}\n\t\t\ttotalGamePending++\n\t   \t\topenBetTotalWinAmount += Number(openBet.eventsWagerDetail.RiskAmount);\n\t   \t\topenBetTotalRiskAmount += Number(openBet.eventsWagerDetail.WinAmount);\n\n\t\t\tagentCreditPending += Number(openBet.eventsWagerDetail.RiskAmount)\n\t\t})\n\t}\n\n\tAgent.findOneAndUpdate({username: req.user.username}, {$set: { creditPending: agentCreditPending }}, {new: true}, function(err, result){\n\t\tconst agent = _.pick(result, ['accountActive', 'accountType', 'creditBalance', 'creditPending', 'passcode', 'username'])\n\t\tagent.openBetTotalRiskAmount = openBetTotalRiskAmount\n\t\tagent.openBetTotalWinAmount = openBetTotalWinAmount\n\t\tagent.openBetStraight = openBetStraight\n\t\tagent.openBetParlay = openBetParlay\n\t\tagent.totalGamePending = totalGamePending\n\t\tres.json(agent)\n\t})\n\n})\n\nrouter.post('/fetch-weekly-summary', (req, res) => {\n\tconst weekNum = req.body.weekNum\n\tlet datesData = {\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(1, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(2, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(3, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(4, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(5, 'day').format('MMM DD')]: 0,\n\t\t[moment().startOf('week').subtract(weekNum, 'day').add(6, 'day').format('MMM DD')]: 0,\n\t\tTotal: 0\n\t}\n\tHistoryBet.find({agent: req.user.username, completedAt: {$gte: moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').format(), $lte: moment().endOf('week').subtract(weekNum, 'day').add(0, 'day').format()}}, function(err, weeklyHistoryResult){\n\t\tif(err) throw err\n\t\tif(!_.isEmpty(weeklyHistoryResult)){\n\t\t\tweeklyHistoryResult.map(function(event, eventIdx){\n\t\t\t\tdatesData[moment(event.completedAt).format('MMM DD')] += Number(event.orderResultAmount)\n\t\t\t\tdatesData.Total += Number(event.orderResultAmount)\n\t\t\t})\n\t\t\tres.json(datesData)\n\t\t}else{\n\t\t\tres.json(datesData)\n\t\t}\n\t})\n\n})\n\n\nexport default router;\n"]}