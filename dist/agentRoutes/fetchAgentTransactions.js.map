{"version":3,"sources":["../../src/agentRoutes/fetchAgentTransactions.js"],"names":["OpenBet","router","Router","post","req","res","weekNum","body","openBetTransactions","transactions","find","agent","user","username","createdAt","$gte","startOf","subtract","add","format","$lte","endOf","agentOpenBets","isEmpty","completedAt","agentTransactions","json"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;AADA,IAAMA,UAAU,mBAASA,OAAzB;;AAEA,IAAMC,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOE,IAAP,CAAY,4BAAZ;AAAA,sDAA0C,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACnCC,aADmC,GACzBF,IAAIG,IAAJ,CAASD,OADgB;AAErCE,yBAFqC,GAEf,EAFe;AAGrCC,kBAHqC,GAGtB,EAHsB;AAAA;AAAA,aAKbT,QAAQU,IAAR,CAAa,EAAEC,OAAOP,IAAIQ,IAAJ,CAASC,QAAlB,EAA4BC,WAAW,EAACC,MAAM,wBAASC,OAAT,CAAiB,MAAjB,EAAyBC,QAAzB,CAAkCX,OAAlC,EAA2C,KAA3C,EAAkDY,GAAlD,CAAsD,CAAtD,EAAyD,KAAzD,EAAgEC,MAAhE,EAAP,EAAiFC,MAAM,wBAASC,KAAT,CAAe,MAAf,EAAuBJ,QAAvB,CAAgCX,OAAhC,EAAyC,KAAzC,EAAgDY,GAAhD,CAAoD,CAApD,EAAuD,KAAvD,EAA8DC,MAA9D,EAAvF,EAAvC,EAAb,CALa;;AAAA;AAKnCG,mBALmC;;AAMzC,UAAG,CAAC,iBAAEC,OAAF,CAAUD,aAAV,CAAJ,EAA6B;AAC5Bd,6BAAsBc,aAAtB;AACA;;AARwC;AAAA,aAUT,2BAAiBZ,IAAjB,CAAsB,EAAEC,OAAOP,IAAIQ,IAAJ,CAASC,QAAlB,EAA4BW,aAAa,EAACT,MAAM,wBAASC,OAAT,CAAiB,MAAjB,EAAyBC,QAAzB,CAAkCX,OAAlC,EAA2C,KAA3C,EAAkDY,GAAlD,CAAsD,CAAtD,EAAyD,KAAzD,EAAgEC,MAAhE,EAAP,EAAiFC,MAAM,wBAASC,KAAT,CAAe,MAAf,EAAuBJ,QAAvB,CAAgCX,OAAhC,EAAyC,KAAzC,EAAgDY,GAAhD,CAAoD,CAApD,EAAuD,KAAvD,EAA8DC,MAA9D,EAAvF,EAAzC,EAAtB,CAVS;;AAAA;AAUnCM,uBAVmC;;AAWzC,UAAG,CAAC,iBAAEF,OAAF,CAAUE,iBAAV,CAAJ,EAAiC;AAChChB,sBAAegB,iBAAf;AACA;;AAEDpB,UAAIqB,IAAJ,CAAS,EAAElB,qBAAqBA,mBAAvB,EAA4CC,cAAcA,YAA1D,EAAT;;AAfyC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAA1C;;AAAA;AAAA;AAAA;AAAA;;kBAmBeR,M","file":"fetchAgentTransactions.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport AgentTransaction from '../models/AgentTransaction'\nimport BetOrder from '../models/BetOrder'\nconst OpenBet = BetOrder.OpenBet\nimport express from 'express';\nconst router = express.Router();\n\nrouter.post('/fetch-weekly-transactions', async (req, res) => {\n\tconst weekNum = req.body.weekNum\n\tlet openBetTransactions = []\n\tlet transactions = []\n\n\tconst agentOpenBets = await OpenBet.find({ agent: req.user.username, createdAt: {$gte: moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').format(), $lte: moment().endOf('week').subtract(weekNum, 'day').add(0, 'day').format()} })\n\tif(!_.isEmpty(agentOpenBets)){\n\t\topenBetTransactions = agentOpenBets\n\t}\n\n\tconst agentTransactions = await AgentTransaction.find({ agent: req.user.username, completedAt: {$gte: moment().startOf('week').subtract(weekNum, 'day').add(0, 'day').format(), $lte: moment().endOf('week').subtract(weekNum, 'day').add(0, 'day').format()} })\n\tif(!_.isEmpty(agentTransactions)){\n\t\ttransactions = agentTransactions\n\t}\n\n\tres.json({ openBetTransactions: openBetTransactions, transactions: transactions })\n\n})\n\nexport default router;"]}