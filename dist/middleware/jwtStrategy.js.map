{"version":3,"sources":["../../src/middleware/jwtStrategy.js"],"names":["ExtractJwt","JwtStrategy","Strategy","jwtOptions","jwtFromRequest","fromAuthHeader","secretOrKey","jwtSecret","strategy","jwt_payload","next","accountType","findOne","username","err","user","agent"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,aAAa,sBAAYA,UAA/B;AACA,IAAMC,cAAc,sBAAYC,QAAhC;;AAGA,IAAIC,aAAa,EAAjB;AACAA,WAAWC,cAAX,GAA4BJ,WAAWK,cAAX,EAA5B;AACAF,WAAWG,WAAX,GAAyB,iBAAOC,SAAhC;;AAGA,IAAIC,WAAW,IAAIP,WAAJ,CAAgBE,UAAhB,EAA4B,UAASM,WAAT,EAAsBC,IAAtB,EAA4B;AACtE,SAAOD,YAAYE,WAAnB;AACC,OAAK,MAAL;AACC,kBAAKC,OAAL,CAAa,EAACC,UAAUJ,YAAYI,QAAvB,EAAb,EAA+C,8DAA/C,EAA+G,UAASC,GAAT,EAAcC,IAAd,EAAmB;AACjIA,WAAOL,KAAK,IAAL,EAAWK,IAAX,CAAP,GAA0BL,KAAK,IAAL,EAAW,KAAX,CAA1B;AACA,IAFD;AAGA;AACD,OAAK,OAAL;AACC,mBAAME,OAAN,CAAc,EAACC,UAAUJ,YAAYI,QAAvB,EAAd,EAAgD,+EAAhD,EAAiI,UAASC,GAAT,EAAcE,KAAd,EAAoB;AACpJA,YAAQN,KAAK,IAAL,EAAWM,KAAX,CAAR,GAA4BN,KAAK,IAAL,EAAW,KAAX,CAA5B;AACA,IAFD;AAGA;AACD;AACCA,QAAK,IAAL,EAAW,KAAX;AACA;AAbF;AAkBA,CAnBc,CAAf;;kBAqBeF,Q","file":"jwtStrategy.js","sourcesContent":["import config from '../config';\nimport User from '../models/User';\nimport Agent from '../models/Agent';\nimport passport from \"passport\";\nimport passportJWT from \"passport-jwt\";\nconst ExtractJwt = passportJWT.ExtractJwt;\nconst JwtStrategy = passportJWT.Strategy;\n\n\nlet jwtOptions = {}\njwtOptions.jwtFromRequest = ExtractJwt.fromAuthHeader();\njwtOptions.secretOrKey = config.jwtSecret;\n\n\nlet strategy = new JwtStrategy(jwtOptions, function(jwt_payload, next) {\n\tswitch(jwt_payload.accountType){\n\t\tcase 'user':\n\t\t\tUser.findOne({username: jwt_payload.username}, 'username agent superAgent passcode accountActive accountType', function(err, user){\n\t\t\t\tuser ? next(null, user) : next(null, false)\n\t\t\t})\n\t\t\tbreak;\n\t\tcase 'agent':\n\t\t\tAgent.findOne({username: jwt_payload.username}, 'username creditBalance accountActive passcode superAgent accountType userList', function(err, agent){\n\t\t\t\tagent ? next(null, agent) : next(null, false)\n\t\t\t})\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tnext(null, false)\n\t\t\treturn;\n\t}\n\n\n\n});\n\nexport default strategy"]}