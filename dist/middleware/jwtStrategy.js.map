{"version":3,"sources":["../../src/middleware/jwtStrategy.js"],"names":["ExtractJwt","JwtStrategy","Strategy","jwtOptions","jwtFromRequest","fromAuthHeader","secretOrKey","jwtSecret","strategy","jwt_payload","next","accountType","findOne","username","err","user","agent"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,aAAa,sBAAYA,UAA/B;AACA,IAAMC,cAAc,sBAAYC,QAAhC;;AAGA,IAAIC,aAAa,EAAjB;AACAA,WAAWC,cAAX,GAA4BJ,WAAWK,cAAX,EAA5B;AACAF,WAAWG,WAAX,GAAyB,iBAAOC,SAAhC;;AAGA,IAAIC,WAAW,IAAIP,WAAJ,CAAgBE,UAAhB,EAA4B,UAASM,WAAT,EAAsBC,IAAtB,EAA4B;AACtE,SAAOD,YAAYE,WAAnB;AACC,OAAK,MAAL;AACC,kBAAKC,OAAL,CAAa,EAACC,UAAUJ,YAAYI,QAAvB,EAAb,EAA+C,UAASC,GAAT,EAAcC,IAAd,EAAmB;AACjE,QAAGA,IAAH,EAAQ;AACPL,UAAK,IAAL,EAAWK,IAAX;AACA,KAFD,MAEK;AACJL,UAAK,IAAL,EAAW,KAAX;AACA;AACD,IAND;AAOA;AACD,OAAK,OAAL;AACC,mBAAME,OAAN,CAAc,EAACC,UAAUJ,YAAYI,QAAvB,EAAd,EAAgD,UAASC,GAAT,EAAcE,KAAd,EAAoB;AACnE,QAAGA,KAAH,EAAS;AACRN,UAAK,IAAL,EAAWM,KAAX;AACA,KAFD,MAEK;AACJN,UAAK,IAAL,EAAW,KAAX;AACA;AACD,IAND;AAOA;AACD;AACCA,QAAK,IAAL,EAAW,KAAX;AACA;AArBF;AA0BA,CA3Bc,CAAf;;kBA6BeF,Q","file":"jwtStrategy.js","sourcesContent":["import config from '../config';\nimport User from '../models/User';\nimport Agent from '../models/Agent';\nimport passport from \"passport\";\nimport passportJWT from \"passport-jwt\";\nconst ExtractJwt = passportJWT.ExtractJwt;\nconst JwtStrategy = passportJWT.Strategy;\n\n\nlet jwtOptions = {}\njwtOptions.jwtFromRequest = ExtractJwt.fromAuthHeader();\njwtOptions.secretOrKey = config.jwtSecret;\n\n\nlet strategy = new JwtStrategy(jwtOptions, function(jwt_payload, next) {\n\tswitch(jwt_payload.accountType){\n\t\tcase 'user':\n\t\t\tUser.findOne({username: jwt_payload.username}, function(err, user){\n\t\t\t\tif(user){\n\t\t\t\t\tnext(null, user);\n\t\t\t\t}else{\n\t\t\t\t\tnext(null, false)\n\t\t\t\t}\n\t\t\t})\n\t\t\tbreak;\n\t\tcase 'agent':\n\t\t\tAgent.findOne({username: jwt_payload.username}, function(err, agent){\n\t\t\t\tif(agent){\n\t\t\t\t\tnext(null, agent);\n\t\t\t\t}else{\n\t\t\t\t\tnext(null, false)\n\t\t\t\t}\n\t\t\t})\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tnext(null, false)\n\t\t\treturn;\n\t}\n\n\n\n});\n\nexport default strategy"]}